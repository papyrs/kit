<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,viewport-fit=cover"/><meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src 'self' https://media.tenor.com/ https://images.unsplash.com/; manifest-src 'self'; style-src 'self' 'unsafe-inline' https://www.gstatic.com https://fonts.googleapis.com https://unpkg.com/; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; script-src 'self' 'nonce-papy-b2f605dc-c66e-49fc-885e-89accd4f5d44' 'sha256-JtjE7gmW4CSplmipwnKzidppLmmWE2c2gy60VRLs88M=' https://unpkg.com/; upgrade-insecure-requests;"/><meta property="og:site_name" content="Papyrs"/><meta name="author" content="{{DECKDECKGO_AUTHOR}}"/><meta property="og:url" content="{{DECKDECKGO_URL}}"/><meta property="og:image" content="https://deckdeckgo.com/assets/meta/deckdeckgo-meta.png"/><meta property="og:image:type" content="image/png"/><meta name="twitter:site" content="@PapyrsApp"/><meta name="twitter:image:src" content="https://deckdeckgo.com/assets/meta/deckdeckgo-meta.png"/><meta name="twitter:card" content="summary_large_image"/><!-- Favicon --><link rel="apple-touch-icon" sizes="48x48" href="https://deckdeckgo.com/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="https://deckdeckgo.com/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="https://deckdeckgo.com/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="https://deckdeckgo.com/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="https://deckdeckgo.com/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="https://deckdeckgo.com/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="https://deckdeckgo.com/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="https://deckdeckgo.com/icons/icon-512x512.png"/><link rel="icon" href="https://deckdeckgo.com/favicon-32x32.png" type="image/png"/><meta name="theme-color" content="#ffffff"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><meta name="msapplication-tap-highlight" content="no"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/><link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500;700&display=swap" rel="stylesheet"/><script type="module" src="/build/index-KBD4IHFC.js"></script><link href="/build/index-LO55ESMI.css" rel="stylesheet"><link href="/build/doc/index-ZP3OQYFH.css" rel="stylesheet"><title>{{DECKDECKGO_TITLE}}</title><meta name="description" content="{{DECKDECKGO_DESCRIPTION}}"/><meta property="og:title" content="{{DECKDECKGO_TITLE}}"/><meta property="og:description" content="{{DECKDECKGO_DESCRIPTION}}"/><meta property="og:site_name" content="{{DECKDECKGO_TITLE}}"/><meta property="og:type" content="article"/><meta name="twitter:title" content="{{DECKDECKGO_TITLE}}"/><meta name="twitter:description" content="{{DECKDECKGO_DESCRIPTION}}"/><script type="module" src="https://unpkg.com/@deckdeckgo/core@latest/dist/deckdeckgo/deckdeckgo.esm.js"></script><script type="module" src="https://unpkg.com/@deckdeckgo/highlight-code@latest/dist/deckdeckgo-highlight-code/deckdeckgo-highlight-code.esm.js"></script><script type="module" src="https://unpkg.com/@deckdeckgo/lazy-img@latest/dist/deckdeckgo-lazy-img/deckdeckgo-lazy-img.esm.js"></script><!-- DECKDECKGO_HEAD_EXTRA --></head><body><nav><button type="button" class="toolbar"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg> <span>Menu</span></button><div role="menu" aria-orientation="vertical" class="popover" style="display:none"><div class="backdrop"></div><div class="wrapper">Hello World</div></div></nav><script nonce="papy-b2f605dc-c66e-49fc-885e-89accd4f5d44">const setPosition=()=>{const e=document.querySelector("button.toolbar"),{bottom:o,left:t}=e?e.getBoundingClientRect():{bottom:0,left:0},r=document.querySelector("div.popover");r?.style.setProperty("--popover-top",`${o}px`),r?.style.setProperty("--popover-left",`${t}px`)},showPopover=()=>{const e=document.querySelector("div.popover");if(!e)return void console.error("No popover to display. Quite weird");const o=new MutationObserver((()=>{o.disconnect(),setTimeout((()=>e?.classList.add("show")),100)}));o.observe(e,{attributes:!0}),e?.style.setProperty("display","block")},hidePopover=()=>{const e=document.querySelector("div.popover");if(!e)return void console.error("No popover to display. Quite weird");const o=new MutationObserver((()=>{o.disconnect(),setTimeout((()=>e?.style.setProperty("display","none")),100)}));o.observe(e,{attributes:!0}),e?.classList.remove("show")},init=()=>{setPosition();document.querySelector("button.toolbar")?.addEventListener("click",showPopover,{passive:!0});document.querySelector("div.backdrop")?.addEventListener("click",hidePopover,{passive:!0})};document.addEventListener("DOMContentLoaded",init,{once:!0}),window.addEventListener("resize",setPosition,{passive:!0})</script><main><article contenteditable="true" class="deckgo-doc stylo-container"><h1 paragraph_id="SwI1OoL8H-iMoJE9NHTPr"><span style="font-size:58.3333px">Export To The File System (Save As) + Fallback In JavaScript</span></h1><deckgo-lazy-img paragraph_id="HPs-NcshlrkARDw8kAIUd" img-src="https://zhx6p-eqaaa-aaaai-abbrq-cai.raw.ic0.app/images/ivan-diaz-gcynzrxspce-unsplash-copie.jpg?token=7d3dab62-3d70-4541-a9f6-8057f0dda373" img-alt="ivan-diaz-gcynzrxspce-unsplash-copie.jpg" class="hydrated loaded"></deckgo-lazy-img><div paragraph_id="7h73arA6eSOLk1V60fH-7"><div style="text-align:center"><span style="color:#ccc"><span style="font-size:medium;font-family:var(--ion-font-family, inherit)">Photo by </span><a href="https://unsplash.com/@ivvndiaz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener noreferrer" style="font-size:medium;background-color:#fff;font-family:var(--ion-font-family, inherit)">Ivan Diaz</a><span style="font-size:medium;font-family:var(--ion-font-family, inherit)"> on </span><a href="https://unsplash.com/s/photos/download?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener noreferrer" style="font-size:medium;background-color:#fff;font-family:var(--ion-font-family, inherit)">Unsplash</a></span></div></div><deckgo-hr paragraph_id="0MZ9DMdvLb4-PmJNWpBZF"></deckgo-hr><div paragraph_id="f5lyclwgQhNJC-0OC8mqE">In almost every web application I end up reusing the same pattern to export data to the file system in JavaScript - i.e. a solution that uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API" rel="noopener noreferrer">File System Access API</a> and a good old "download" feature as fallback. <span jsaction="mouseup:BR6jm" jsname="jqKxS" lang="en" style="font-family:var(--ion-font-family, inherit)">I thought it was worth writing a post about it as documentation</span><span style="font-family:var(--ion-font-family, inherit)"> purpose ðŸ˜‰.</span></div><deckgo-hr paragraph_id="JNk0uyDK_J6k2lorgtfnD"></deckgo-hr><h2 paragraph_id="lZk7JjOdt97NMc4BoPymo">&ZeroWidthSpace;Introduction</h2><div paragraph_id="dFTcLRS9RsShSgAYVpjOK">&ZeroWidthSpace;The File System Access API allows read, write and file management capabilities within your browser. It enables developers to build powerful web apps that interact with files on the user's local device.</div><div paragraph_id="gaxCqgr4jNvJyWqH6rF6b"><div paragraph_id="89651d9b-f6ac-4a07-abe0-1e82b48d23af"><br/></div><div paragraph_id="89651d9b-f6ac-4a07-abe0-1e82b48d23af">The web.dev team has a wonderful <a href="https://web.dev/file-system-access/" rel="noopener noreferrer">tutorial</a> that introduces and highlights all the features.</div></div><div paragraph_id="RUaJ27jfIhpb3wZhi2gD6">&ZeroWidthSpace;</div><div paragraph_id="yaWSgay00KFKdfmEixOtt"></div><div paragraph_id="ItMMMFmmJMcUsdtwpEf2o">&ZeroWidthSpace;&ZeroWidthSpace;Is is a relatively new API and therefore is not yet adopted by all browser vendors.</div><div paragraph_id="B7lCCDZic7-b_4hcBfnAp">&ZeroWidthSpace;</div><deckgo-hr paragraph_id="jlUVebgNEw24kpYiXR04Q"></deckgo-hr><div paragraph_id="2uMrw6f7FKrvxhWt40wXA">&ZeroWidthSpace;</div><h2 paragraph_id="x6RKoVbf9dXpoXoKjoltt">Getting Started</h2><div paragraph_id="8VOpst6VG5gmh52L8rDgb">&ZeroWidthSpace;Generally speaking I use TypeScript. This solution is provided with type safety as well. That's why it needs first the installation of the type definitions for the File System Access API.</div><deckgo-highlight-code paragraph_id="JInCGNJ5K9rPGeCuXH6K-" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="bash" terminal="carbon" theme="dracula"><code slot="code">npm i -D @types/wicg-file-system-access</code></deckgo-highlight-code><deckgo-hr paragraph_id="j2h55BA0UnUyYhJKvSu9D"></deckgo-hr><h2 paragraph_id="QBeIURH1sShKunOvxzKry">&ZeroWidthSpace;Hands-on</h2><div paragraph_id="-YoaGGkfe1ox_3j2YM-IH">&ZeroWidthSpace;To export file I use a <mark>&ZeroWidthSpace;Blob</mark>&ZeroWidthSpace; - i.e. the content of the file I want to export - and a <mark>&ZeroWidthSpace;filename</mark>&ZeroWidthSpace; . I create a single function that saves to the user's local device and that can be use across my app.</div><deckgo-highlight-code paragraph_id="lZ0ZB6cPleisQnJ1m1N0r" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="javascript" terminal="carbon" theme="dracula"><code slot="code">export const save = (data: {blob: Blob, filename: string}) =&gt; { if ('showSaveFilePicker' in window) { return exportNativeFileSystem(data); } return download(data); };</code></deckgo-highlight-code><deckgo-hr paragraph_id="Jqsj960eX7sx7P-SIWsbe"></deckgo-hr><h3 paragraph_id="gyCckuvDaECy79BfFw3o3">File System Access API - Save As</h3><div paragraph_id="7Kw-DurZQERgUSArtW38-">&ZeroWidthSpace;</div><div paragraph_id="p4rT3cP8P1ejVBGOVMfmG">&ZeroWidthSpace;<span style="font-size:19.1944px;font-family:var(--ion-font-family, inherit)">&ZeroWidthSpace;Above feature tests if </span><mark style="font-size:19.1944px">&ZeroWidthSpace;showSaveFilePicker</mark><span style="font-size:19.1944px;font-family:var(--ion-font-family, inherit)">&ZeroWidthSpace; is available in the </span><mark style="font-size:19.1944px">&ZeroWidthSpace;window</mark><span style="font-size:19.1944px;font-family:var(--ion-font-family, inherit)">&ZeroWidthSpace; object - i.e. it checks if the browser supports the File System API or not.</span></div><div paragraph_id="MMeyizi-iI78bKm07ZkXI">&ZeroWidthSpace;</div><div paragraph_id="i9bGL_IpuYbXQqK8ghHWJ">&ZeroWidthSpace;To save the file with the new API, we should first show the user a dialog in "save" mode in which the user can pick the location where the file should be saved. Once the path set, the file can effectively be written to the local drive.</div><deckgo-highlight-code paragraph_id="KO16X_Q0Jwoautu3NvdQl" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="javascript" terminal="carbon" theme="dracula"><code slot="code">const exportNativeFileSystem = async ({blob, filename}: {blob: Blob, filename: string}) =&gt; { const fileHandle: FileSystemFileHandle = await getNewFileHandle({filename}); if (!fileHandle) { throw new Error('Cannot access filesystem'); } await writeFile({fileHandle, blob}); };</code></deckgo-highlight-code><div paragraph_id="leMbMMfPmSXfHcuh_noHp">&ZeroWidthSpace;</div><div paragraph_id="GUO6TqRvb67z2UJa9ylGP">&ZeroWidthSpace;In many cases I want my app to suggest a default file name. This can be achieved by passing <mark>&ZeroWidthSpace;suggestedName</mark>&ZeroWidthSpace; to <mark>&ZeroWidthSpace;showSaveFilePicker</mark>&ZeroWidthSpace; - the function of the API that displays the prompt. In addition, I also scope the type(s) of files that can be selected by providing mime types and related file extensions.</div><deckgo-highlight-code paragraph_id="nQ9E6bWILIP_r6r0OeuKK" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="typescript" terminal="carbon" theme="dracula"><code slot="code">const getNewFileHandle = ({filename}: {filename: string}): Promise&lt;FileSystemFileHandle&gt; =&gt; { const opts: SaveFilePickerOptions = { suggestedName: filename, types: [ { description: 'Markdown file', accept: { 'text/plain': ['.md'] } } ] }; return showSaveFilePicker(opts); };</code></deckgo-highlight-code><div paragraph_id="9aD97nn1C3Ic65F-5C3uy"><br/></div><div paragraph_id="u2g1x_bWS3l59JpryE_m7">Finally the file can be effectively written with <mark>&ZeroWidthSpace;writeFile</mark> - another function of the API&ZeroWidthSpace;. It uses the handle I previously request to get to know where to export the data and write to the stream.</div><deckgo-highlight-code paragraph_id="pid2N_4JBRwDU6JW5Lp2e" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="javascript" terminal="carbon" theme="dracula"><code slot="code">const writeFile = async ({fileHandle, blob}: {fileHandle: FileSystemFileHandle, blob: Blob}) =&gt; { const writer = await fileHandle.createWritable(); await writer.write(blob); await writer.close(); };</code></deckgo-highlight-code><deckgo-hr paragraph_id="fF26wSbUfujGBYKHpByIM"></deckgo-hr><h3 paragraph_id="11oebpjm2ypP4YnU6F8Zq">&ZeroWidthSpace;Fallback - Download</h3><div paragraph_id="8rPnksBYyrfUFa4S3V5n_">As a fallback, I add to the DOM a temporary anchor element that is automatically clicked. To export the file to the default download folder of the user, I provide an&ZeroWidthSpace; object as a URL representing the <mark>&ZeroWidthSpace;blob</mark>&ZeroWidthSpace;.</div><deckgo-highlight-code paragraph_id="hOPQhWx6A7JR6cZ5w9E40" class="deckgo-highlight-code-carbon deckgo-highlight-code-theme-dracula hydrated" language="javascript" terminal="carbon" theme="dracula"><code slot="code">const download = ({filename, blob}: {filename: string; blob: Blob}) =&gt; { const a: HTMLAnchorElement = document.createElement('a'); a.style.display = 'none'; document.body.appendChild(a); const url: string = window.URL.createObjectURL(blob); a.href = url; a.download = `${filename}.md`; a.click(); window.URL.revokeObjectURL(url); a.parentElement?.removeChild(a); };</code></deckgo-highlight-code><deckgo-hr paragraph_id="pwuoc7pYjFZXFvE5K7QDu"></deckgo-hr><h2 paragraph_id="0zzhhwcFLnGOULVn7UFje">&ZeroWidthSpace;Grab The Code</h2><div paragraph_id="bb3NEtVP_LjQhn3RVW13W">&ZeroWidthSpace;You can find all the code presented in this article in a recent Chrome plugin I open sourced on GitHub ðŸ‘‰ <a href="https://github.com/papyrs/markdown-plugin/blob/main/src/plugin/utils/save.utils.ts" rel="noopener noreferrer">save-utils.ts</a></div><deckgo-hr paragraph_id="zNdkYso0DtByrrQ2pW4YX"></deckgo-hr><h2 paragraph_id="2Rcp3fMf0d6-XR62-q_UY">&ZeroWidthSpace;Summary</h2><div paragraph_id="oIwULgpF5xa9wfjDpLexP">&ZeroWidthSpace;That was a fairly short post which I hope was at least a bit entertaining ðŸ¤ª. If you would like to dig deeper the File System Access API, I once again advise you to have a look at the nice post of the <a href="https://web.dev/file-system-access/" rel="noopener noreferrer">web.dev</a> team.</div><div paragraph_id="GMnBBHhwKExup5foIGjvT">&ZeroWidthSpace;</div><div paragraph_id="7x0OXrTuZOtW558UbQLJG">&ZeroWidthSpace;To infinity and beyond<br/>David&ZeroWidthSpace;</div><div paragraph_id="0nnz6eqFSw5L6LpoaRjGk">&ZeroWidthSpace;</div></article></main><script type="module" src="https://unpkg.com/web-social-share@latest/dist/websocialshare/websocialshare.esm.js"></script><web-social-share show="false" style="--web-social-share-backdrop-opacity:0.5"><ion-icon name="logo-twitter" aria-label="Twitter" slot="twitter" style="color:#00aced;font-size:1.6rem;display:block"></ion-icon><ion-icon name="logo-reddit" aria-label="Reddit" slot="reddit" style="color:#ff5700;font-size:1.6rem;display:block"></ion-icon><ion-icon name="logo-linkedin" aria-label="Linkedin" slot="linkedin" style="color:#0077b5;font-size:1.6rem;display:block"></ion-icon><ion-icon name="mail" aria-label="Email" slot="email" style="color:#ff8ea3;font-size:1.6rem;display:block"></ion-icon><ion-icon name="logo-whatsapp" aria-label="WhatsApp" slot="whatsapp" style="color:#25d366;font-size:1.6rem;display:block"></ion-icon><ion-icon name="logo-hackernews" aria-label="Hacker News" slot="hackernews" style="color:#ff6000;font-size:1.6rem;display:block"></ion-icon></web-social-share><noscript>Please enable Javascript to access this blog.</noscript></body></html>